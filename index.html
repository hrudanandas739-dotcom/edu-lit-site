<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>English Literature Library</title>
  <style>
    body{font-family:system-ui,Arial;margin:0;background:#f6f8fb;color:#111}
    .container{max-width:900px;margin:28px auto;padding:16px}
    header{display:flex;justify-content:space-between;align-items:center}
    h1{margin:0 0 8px}
    .search{margin:12px 0}
    input[type="search"]{width:100%;padding:10px;border-radius:8px;border:1px solid #cbd5e1}
    .list{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .item{background:#fff;padding:12px;border-radius:10px;border:1px solid #e6eef8;display:flex;justify-content:space-between;align-items:center}
    .meta{max-width:68%}
    .tag{font-size:12px;color:#0366d6;margin-top:6px}
    .actions a{margin-left:8px;padding:8px 10px;border-radius:8px;text-decoration:none;background:#0366d6;color:#fff}
    .viewer{margin-top:18px;border:1px solid #ccdbea;border-radius:8px;min-height:360px;overflow:hidden}
    embed{width:100%;height:600px;border:0}
    .note{padding:12px;background:#fff;border-radius:8px;border:1px solid #e6eef8}
    footer{margin-top:18px;color:#666;font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>English Literature Library</h1>
        <div class="muted">Organise PDFs & notes — add your files to <code>assets/pdfs/</code></div>
      </div>
      <div><a href="admin.html">Admin / Upload Instructions</a></div>
    </header>

    <div class="search">
      <input id="q" type="search" placeholder="Search title, author, tag..." oninput="render()" />
    </div>

    <div id="list" class="list"></div>

    <div id="viewer" class="viewer" style="display:none"></div>

    <footer>Tip: For Android app, place PDFs into <code>app/src/main/assets/pdfs/</code> then update <code>assets/pdfs.json</code>.</footer>
  </div>

<script>
let data = [];

async function loadData(){
  try{
    const res = await fetch('assets/pdfs.json');
    data = await res.json();
  }catch(e){
    data = [];
  }
  render();
}

function render(){
  const q = document.getElementById('q').value.toLowerCase().trim();
  const list = document.getElementById('list');
  list.innerHTML = '';
  const filtered = data.filter(d=> {
    if(!q) return true;
    return (d.title+d.author+(d.tags||'')).toLowerCase().includes(q);
  });
  if(filtered.length===0){
    list.innerHTML = '<div class="item">No items found. Add PDFs in <code>assets/pdfs/</code> and update <code>assets/pdfs.json</code>.</div>';
    return;
  }
  filtered.forEach(d=>{
    const div = document.createElement('div');
    div.className='item';
    div.innerHTML = `<div class="meta"><strong>${escapeHtml(d.title)}</strong><div class="tag">${escapeHtml(d.author||'Unknown')} • ${escapeHtml((d.tags||'').split(',').join(' • '))}</div></div>
      <div class="actions">
        <a href="#" onclick="view('${encodeURIComponent(d.file)}');return false">View</a>
        <a href="assets/${d.file}" download>Download</a>
      </div>`;
    list.appendChild(div);
  });
}

function view(file){
  const viewer = document.getElementById('viewer');
  viewer.style.display = 'block';
  const ext = file.split('.').pop().toLowerCase();
  if(ext==='pdf'){
    viewer.innerHTML = `<embed src="assets/${file}" type="application/pdf">`;
  } else {
    viewer.innerHTML = `<div class="note">Loading note...<iframe src="assets/${file}" style="width:100%;height:600px;border:0"></iframe></div>`;
  }
  window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'});
}

function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

loadData();
</script>
</body>
</html>
